<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE muclient>

<muclient>

<plugin
   name="Thesaurus"
   author="Nick Gammon"
   id="fed86e24fd1ed8a47d97ecb6"
   language="Lua"
   purpose="Lookups a word in Thesaurus."
   requires="5.00"
   version="1.0"
  >
</plugin>

<aliases>
  <alias
   enabled="y"
   match="^tlookup( (?P&lt;word&gt;.*)){0,1}$"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>
    local word = "%&lt;word&gt;"
    if #word == 0 then
      word = utils.inputbox("Word to lookup in Thesaurus?", "Thesaurus")
    end
    if not word then
      return
    end
    local pos = thes[word:lower()]
    if not pos then
      utils.msgbox("The word '"..word.."' isn't in the Thesaurus.", "Not Found")
      return
    end
    thes_file:seek("set", pos)
    local line = thes_file:read()
    local t = utils.split(line, ",")
    local choice = utils.listbox("Matching words for '"..word.."\\n\\nClick OK to copy it into the clipboard.", "Thesaurus: "..word, t)
    if choice then
      SetClipboard(t[choice])
    end
  </send>
  </alias>
</aliases>

<script>
<![CDATA[

function OnPluginInstall()
  thes = {}
  local name = string.gsub(GetInfo(66), "\\", "/").."Spell/Thesaurus.lex"
  thes_file = io.input(name)
  repeat
    local pos = thes_file:seek()
    local line = thes_file:read()
    if line then
      local w = string.match(line, "[^,]+")
      thes[w:lower()] = pos
    end
  until not line 
  ColourNote("white", "blue", "Thesaurus loaded.")
end

]]>
</script> 

</muclient>
